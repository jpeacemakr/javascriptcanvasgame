<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <style>
            body {
                text-align:center;
            }
            canvas {
                border:1px solid #d3d3d3;
                background-color: #f1f1f1;
            }
            .center {
                width:600px;
                margin:auto;
            }
            div {
                text-align:left;
            }
        </style>


        <script>

            ///////////////////////////////////
            // about
            // by James Peacemaker
            // the game is made up of a matrix of squares like a checkerboard
            // the game piece can move from one game square to another


            ////////////////////////////////////
            // game variables
            var gameSquareSize = 20; // size of the game piece and game squares
            var gameSquareNumber = 30; // number of game squares
            var gameTotalArea = 600; // total area of the game board (should be gameSquareSize * gameSquareNumber)


            ///////////////////////////////
            // represents each square on the board
            class GameSquare {
                // let mySquare = new GameSquare();
                constructor() {
                    this.hidden = true;
                    this.value = 0;
                }
                reveal() {
                    this.hidden = false;
                }
            }

            /////////////////////////////////        
            // start the game. called from body onload()
            function startGame() {
                myGameArea.start(gameTotalArea, gameTotalArea);
                myGameArea.render();
            }

            //////////////////////////////
            // object to control the board
            var myGameArea = {
                // grid of game piece positions
                gameMatrix: new Array (gameSquareNumber),
                
                // canvas to draw into
                canvas : document.createElement("canvas"),
                
                // initializes the values of the game board then calls function to initialize game piece
                start : function(width, height) {
                    this.canvas.width = width;
                    this.canvas.height = height;
                    this.context = this.canvas.getContext("2d");
                    document.getElementById("canvasDiv").appendChild(this.canvas);
                    
                    this.canvas.addEventListener("mousedown", doMouseDown, false);

                    // turn array into square array of arrays
                    for(let i=0; i<gameSquareNumber; i++){
                        this.gameMatrix[i] = new Array (gameSquareNumber);
                    }

                    // initialize the game squares
                    for(let i=0; i<gameSquareNumber; i++){
                        for(let j=0; j<gameSquareNumber; j++){
                            this.gameMatrix[i][j] = new GameSquare();
                        }
                    }
                    // console.log("Debug: " + this.gameMatrix[3][4].value);

                    //initialize game piece
                    myGamePiece.start(0,0,gameSquareSize,gameSquareSize,"blue");               
                },

                // render the board                
                render : function() {
                    console.log("Debug: rendering myGameArea");
                    // clear the canvas
                    this.context.clearRect(this.x, this.y, this.width, this.height);
                    // redraw the board
                    // draw grid horizontal lines
                    for (var i=1; i < gameSquareNumber; i++) {
                        this.context.moveTo(0, i*gameSquareSize);
                        this.context.lineTo(this.canvas.width, i*gameSquareSize);
                        this.context.lineWidth = 1;
                        this.context.strokeStyle = '#cccccc';
                        this.context.stroke();
                    }
                    // draw grid vertical lines
                    for (var i=1; i < gameSquareNumber; i++) {
                        this.context.moveTo(i*gameSquareSize, 0);
                        this.context.lineTo(i*gameSquareSize, this.canvas.height);
                        this.context.lineWidth = 1;
                        this.context.strokeStyle = '#cccccc';
                        this.context.stroke();
                    }

                    // draw board values
                    this.context.font = '10pt Helvetica';
                    this.context.fillStyle = "#000000";
                    for (var i=0; i < gameSquareNumber; i++) {
                        for (var j=1; j < gameSquareNumber+1; j++) {
                            console.log("Debug: drawing text");
                            this.context.fillText('2', i*gameSquareSize+6, j*gameSquareSize-4);
                        }
                    }

                    // redraw the player
                    myGamePiece.render();
                },

                // reset the game board and player
                clear : function() {
                    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    myGamePiece.clear();
                    this.render();
                }
            }

            
            /////////////////////////////////////
            // sets position of game piece based on mouse click
            function doMouseDown(event) {
                // get position of mouse on screen
                canvasX = event.pageX;
                canvasY = event.pageY;
                //console.log("Debug: screen mouse position " + canvasX + " " + canvasY);

                //subtract canvas position from mouse position on screen
                var rect = myGameArea.canvas.getBoundingClientRect();
                canvasX = canvasX - rect.left;
                canvasY = canvasY - rect.top;
                // console.log("Debug: canvas mouse position " + canvasX + " " + canvasY);

                // clear old position
                myGamePiece.context.clearRect(myGamePiece.x, myGamePiece.y, myGamePiece.width, myGamePiece.height);
                myGamePiece.context.fillStyle = this.color;
                
                // draw new position rounded to the nearest gameSquareSize
                myGamePiece.x = parseInt(canvasX/gameSquareSize)*gameSquareSize;
                myGamePiece.y = parseInt(canvasY/gameSquareSize)*gameSquareSize;

                // console.log("Debug: mouse square position " + myGamePiece.x + " " + myGamePiece.y);
                myGamePiece.context.fillRect(myGamePiece.x, myGamePiece.y, myGamePiece.width, myGamePiece.height);
            }


            ///////////////////////////////////
            // object to control the player's game piece
            var myGamePiece = {
                // default position, size and color
                x : 0,
                y : 0,
                width : gameSquareSize,
                height: gameSquareSize,
                color : "red",
                context: myGameArea.context,

                // set game piece at start                
                start : function(x, y, width, height, color) {
                    this.x = x;
                    this.y = y;
                    this.width = width;
                    this.height = height;
                    this.color = color;
                    this.context = myGameArea.context;
                    this.context.fillStyle = this.color;
                    this.context.fillRect(this.x, this.y, this.width, this.height);
                },

                // render the player again                
                render : function() {
                    console.log("Debug: rendering myGamePiece");
                    this.context.fillStyle = this.color;
                    this.context.fillRect(this.x, this.y, this.width, this.height);
                },

                // movement functions
                moveRight : function() {
                    if (this.x+gameSquareSize<myGameArea.canvas.width){
                        // clear old position
                        this.context.clearRect(this.x, this.y, this.width, this.height);
                        this.context.fillStyle = this.color;
                        // draw new position
                        this.x= this.x + gameSquareSize;
                        this.context.fillRect(this.x, this.y, this.width, this.height);
                    }
                },
                moveLeft : function() {
                    if (this.x>0){
                        // clear old position
                        this.context.clearRect(this.x, this.y, this.width, this.height);
                        this.context.fillStyle = this.color;
                        // draw new position
                        this.x= this.x - gameSquareSize;
                        this.context.fillRect(this.x, this.y, this.width, this.height);
                    }
                },
                moveUp : function() {
                    if (this.y>0){
                        // clear old position
                        this.context.clearRect(this.x, this.y, this.width, this.height);
                        this.context.fillStyle = this.color;
                        // draw new position
                        this.y= this.y - gameSquareSize;
                        this.context.fillRect(this.x, this.y, this.width, this.height);
                    }
                },
                moveDown : function() {
                    if (this.y+gameSquareSize<myGameArea.canvas.height){
                        // clear old position
                        this.context.clearRect(this.x, this.y, this.width, this.height);
                        this.context.fillStyle = this.color;
                        // draw new position
                        this.y= this.y + gameSquareSize;
                        this.context.fillRect(this.x, this.y, this.width, this.height);
                    }
                },
                
                // reset the player to starting position
                clear : function() {
                    this.x = 0;
                    this.y = 0;
                }
            }

            /////////////////////////////////
            // used to detect keyboard button being pressed. Uses onkeydown() in body tag
            function keyPressed(event) {
                if (event.keyCode == 37) {
                    myGamePiece.moveLeft();
                    return true;
                } 
                else if (event.keyCode == 39) {
                    myGamePiece.moveRight();
                    return true;
                } 
                else if (event.keyCode == 38) {
                    myGamePiece.moveUp();
                    return true;
                } 
                else if (event.keyCode == 40) {
                    myGamePiece.moveDown();
                    return true;
                } 
                else {
                    return false;
                }
            }




        </script>

    </head>


    <body onload=" startGame()" onkeydown="return keyPressed(event)">

        <div class="center">
            <p>Here is some text for the game.</p>

            <!-- The canvas where the game is drawn -->
            <div id="canvasDiv"></div>

            
            <!-- The controls -->
            <div>
                <p>Click buttons below or use the arrow keys to move.</p>
                <button onClick="myGamePiece.moveLeft();">MOVE LEFT</button>
                <button onClick="myGamePiece.moveRight();">MOVE RIGHT</button>
                <button onClick="myGamePiece.moveUp();">MOVE UP</button>
                <button onClick="myGamePiece.moveDown();">MOVE DOWN</button>
                <button onClick="myGameArea.clear();">RESET</button>
            </div
        </div>
    </body>
</html>